<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="High-performance dynamic image server in Java
">

  <title>
    Cantaloupe
    
      :: Redaction
    
  </title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="/cantaloupe/css/syntax.css">
  <link rel="stylesheet" href="/cantaloupe/css/base.css">

  <script src="/cantaloupe/scripts/jquery.min.js"></script>
</head>


  <body>

    <div class="container">
      <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">

    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/cantaloupe/">
        <img alt="Cantaloupe" src="/cantaloupe/images/cantaloupe.png" width="40">
      </a>
    </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="/cantaloupe/get-started.html">Get Started</a></li>
        <li><a href="/cantaloupe/manual/">User Manual</a></li>
        <li><a href="/cantaloupe/support.html">Support</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://github.com/medusa-project/cantaloupe/releases.atom" title="Subscribe to Releases"><img width="22" height="22" src="/cantaloupe/images/feed.svg"></a></li>
      </ul>
    </div>

  </div>
</nav>


      <div class="row">
  <div class="col-md-3 hidden-xs hidden-sm">
    <ul class="toc">
  <li><a href="changes.html">What's New in <span class="version">3.0</span></a></li>
  <li><a href="upgrading.html">Upgrading</a></li>
  <li><a href="getting-started.html">Getting Started</a>
    <ul>
      <li><a href="getting-started.html#Requirements">Requirements</a></li>
      <li><a href="getting-started.html#Configuration">Configuration</a></li>
      <li><a href="getting-started.html#Running">Running</a>
        <ul>
          <li><a href="getting-started.html#Standalone">Standalone</a></li>
          <li><a href="getting-started.html#Servlet%20Container">Servlet Container</a></li>
        </ul>
      </li>
      <li><a href="getting-started.html#Control Panel">Control Panel</a></li>
    </ul>
  </li>
  <li>
    <a href="endpoints.html">Endpoints</a>
    <ul>
      <li><a href="endpoints.html#IIIFImageAPI1">IIIF Image API 1.x</a></li>
      <li><a href="endpoints.html#IIIFImageAPI2">IIIF Image API 2.x</a></li>
    </ul>
  </li>
  <li>
    <a href="images.html">Images</a>
    <ul>
      <li><a href="images.html#Size%20Considerations">Size Considerations</a></li>
      <li><a href="images.html#Source%20Formats">Source Formats</a>
        <ul>
          <li><a href="images.html#JPEG">JPEG</a></li>
          <li><a href="images.html#JPEG2000">JPEG2000</a></li>
          <li><a href="images.html#TIFF">TIFF</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="resolvers.html">Resolvers</a>
    <ul>
      <li><a href="resolvers.html#Selection">Selection</a>
        <ul>
          <li><a href="resolvers.html#Static%20Resolver">Static</a></li>
          <li><a href="resolvers.html#Dynamic%20Resolvers">Dynamic</a></li>
        </ul>
      <li><a href="resolvers.html#Implementations">Implementations</a>
        <ul>
          <li><a href="resolvers.html#FilesystemResolver">FilesystemResolver</a></li>
          <li><a href="resolvers.html#HttpResolver">HttpResolver</a></li>
          <li><a href="resolvers.html#JdbcResolver">JdbcResolver</a></li>
          <li><a href="resolvers.html#AmazonS3Resolver">AmazonS3Resolver</a></li>
          <li><a href="resolvers.html#AzureStorageResolver">AzureStorageResolver</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="processors.html">Processors</a>
    <ul>
      <li><a href="processors.html#Operating%20System%20Compatibility">Operating System Compatibility</a></li>
      <li><a href="processors.html#Resolver%20Compatibility">Resolver Compatibility</a></li>
      <li><a href="processors.html#Supported%20Features">Supported Features</a></li>
      <li><a href="processors.html#Supported%20Source%20Formats">Supported Source Formats</a></li>
      <li><a href="processors.html#Implementations">Implementations</a>
        <ul>
          <li><a href="processors.html#Java2dProcessor">Java 2D</a></li>
          <li><a href="processors.html#JaiProcessor">JAI</a></li>
          <li><a href="processors.html#GraphicsMagickProcessor">GraphicsMagick</a></li>
          <li><a href="processors.html#ImageMagickProcessor">ImageMagick</a></li>
          <li><a href="processors.html#KakaduProcessor">Kakadu</a></li>
          <li><a href="processors.html#OpenJpegProcessor">OpenJPEG</a></li>
          <li><a href="processors.html#FfmpegProcessor">FFmpeg</a></li>
          <li><a href="processors.html#PdfBoxProcessor">PDFBox</a></li>
        </ul>
    </ul>
  </li>
  <li>
    <a href="caching.html">Caching</a>
    <ul>
      <li><a href="caching.html#Client-Side%20Caching">Client-Side Caching</li>
      <li><a href="caching.html#Server-Side%20Caching">Server-Side Caching</li>
        <ul>
          <li><a href="caching.html#Source%20Cache">Source Cache</a>
          <li><a href="caching.html#Derivative%20Cache">Derivative Cache</a>
          <li><a href="caching.html#Modes%20of%20Operation">Modes of Operation</a></li>
          <li><a href="caching.html#Maintenance">Maintenance</a></li>
          <li><a href="caching.html#Implementations">Implementations</a>
            <ul>
              <li><a href="caching.html#FilesystemCache">FilesystemCache</a></li>
              <li><a href="caching.html#JdbcCache">JdbcCache</a></li>
              <li><a href="caching.html#AmazonS3Cache">AmazonS3Cache</a></li>
              <li><a href="caching.html#AzureStorageCache">AzureStorageCache</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="access-control.html">Access Control</a>
    <ul>
      <li><a href="access-control.html#Authentication">Authentication</a></li>
      <li><a href="access-control.html#Authorization">Authorization</a></li>
    </ul>
  </li>
  <li><a href="watermarking.html">Watermarking</a>
    <ul>
      <li><a href="watermarking.html#Modes%20of%20Operation">Modes of Operation</a>
        <ul>
            <li><a href="watermarking.html#BasicStrategy">BasicStrategy</a></li>
            <li><a href="watermarking.html#ScriptStrategy">ScriptStrategy</a></li>
        </ul>
      </li>
      <li><a href="watermarking.html#Requirements">Requirements</a></li>
      <li><a href="watermarking.html#Positioning">Positioning</a></li>
      <li><a href="watermarking.html#Processor%20Support">Processor Support</a></li>
      <li><a href="watermarking.html#Implications">Implications</a></li>
    </ul>
  </li>
  <li><a href="redaction.html">Redaction</a>
    <ul>
      <li><a href="redaction.html#Example">Example</a></li>
      <li><a href="redaction.html#Processor%20Support">Processor Support</a></li>
      <li><a href="redaction.html#Implications">Implications</a>
        <ul>
          <li><a href="redaction.html#Performance">Performance</a></li>
          <li><a href="redaction.html#Caching">Caching</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="delegate-script.html">Delegate Script</a>
    <ul>
      <li><a href="delegate-script.html#Rules">Rules</a></li>
      <li><a href="delegate-script.html#Example">Example</a></li>
      <li><a href="delegate-script.html#Testing%20Script%20Methods">Testing Script Methods</a></li>
    </ul>
  </li>
  <li>
    <a href="logging.html">Logging</a>
    <ul>
      <li><a href="logging.html#Application%20Log">Application Log</a></li>
      <li><a href="logging.html#Access%20Log">Access Log</a></li>
    </ul>
  </li>
  <li>
    <a href="deployment.html">Deployment</a>
    <ul>
      <li><a href="deployment.html#Hardware">Hardware</a></li>
      <li><a href="deployment.html#Limiting">Limiting</a></li>
      <li><a href="deployment.html#Reverse-Proxying">Reverse-Proxying</a>
        <ul>
          <li><a href="deployment.html#Reverse-ProxyingApache">Apache</a></li>
          <li><a href="deployment.html#Reverse-ProxyingNginx">nginx</a></li>
        </ul>
      </li>
      <li><a href="deployment.html#SSL/TLS">SSL/TLS</a></li>
    </ul>
  </li>
  <li>
    <a href="developers.html">For Developers</a>
    <ul>
      <li><a href="/cantaloupe/javadoc/3.0/">Javadoc</a></li>
      <li><a href="developers.html#Contributing">Contributing</a></li>
    </ul>
  </li>
</ul>

  </div>
  <div class="col-sm-12 col-md-9">
    <ol class="breadcrumb">
  <li><a href="/cantaloupe/">Home</a></li>
  <li><a href="/cantaloupe/manual/">User Manual</a></li>
  <li><a href="/cantaloupe/manual/3.0/">3.0</a></li>
  <li class="active">Redaction</li>
</ol>

<h1>Redaction</h1>

<ul>
  <li><a href="#Example">Example</a></li>
  <li><a href="#Processor%20Support">Processor Support</a></li>
  <li><a href="#Implications">Implications</a>
    <ul>
      <li><a href="#Performance">Performance</a></li>
      <li><a href="#Caching">Caching</a></li>
    </ul>
  </li>
</ul>

<p>Redactions are black rectangles that are overlaid onto source images in order to obscure parts of them. This can be used for copyright protection, privacy protection, or censorship, without altering any source images. Different redactions can be applied to the same image dynamically for different audiences based on client IP address, cookies, and more.</p>

<p>Redactions are defined with <code>x</code>, <code>y</code>, <code>width</code>, and <code>height</code> properties corresponding to source image coordinates. Redacted regions will be blacked out at every intersecting crop region and scale.</p>

<div class="row">
  <div class="col-sm-6">
    <figure>
      <img class="img-responsive" src="images/redaction-pre-960.jpg">
      <figcaption>Original image</figcaption>
    </figure>
  </div>
  <div class="col-sm-6">
    <figure>
      <img class="img-responsive" src="images/redaction-post-960.jpg">
      <figcaption>Redactions applied</figcaption>
    </figure>
  </div>
</div>

<p>The redaction feature works via the <a href="delegate-script.html">delegate script</a>. First, the delegate script must be enabled, and then, <code>redactions.enabled</code> must be set to <code>true</code> in the configuration file. The delegate script must implement a method called <code>Cantaloupe::redactions</code> that returns an array of source image redaction coordinates in response to a particular request.</p>

<h2 id="Example">Example</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Cantaloupe</span>
  <span class="c1">##</span>
  <span class="c1"># See the argument and return value documentation in delegates.rb.sample.</span>
  <span class="c1">#</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">redactions</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">request_headers</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">,</span> <span class="n">cookies</span><span class="p">)</span>
    <span class="n">redactions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Add two redactions to an image with an identifier of "sample" for all</span>
    <span class="c1"># clients except localhost.</span>
    <span class="k">if</span> <span class="n">identifier</span> <span class="o">==</span> <span class="s1">'sample'</span>
      <span class="k">unless</span> <span class="sx">%w(127.0.0.1 ::1/128)</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">client_ip</span><span class="p">)</span>
        <span class="n">redactions</span> <span class="o">&lt;&lt;</span> <span class="p">{</span>
            <span class="s1">'x'</span> <span class="o">=&gt;</span> <span class="mi">50</span><span class="p">,</span>
            <span class="s1">'y'</span> <span class="o">=&gt;</span> <span class="mi">65</span><span class="p">,</span>
            <span class="s1">'width'</span> <span class="o">=&gt;</span> <span class="mi">120</span><span class="p">,</span>
            <span class="s1">'height'</span> <span class="o">=&gt;</span> <span class="mi">105</span>
        <span class="p">}</span>
        <span class="n">redactions</span> <span class="o">&lt;&lt;</span> <span class="p">{</span>
            <span class="s1">'x'</span> <span class="o">=&gt;</span> <span class="mi">673</span><span class="p">,</span>
            <span class="s1">'y'</span> <span class="o">=&gt;</span> <span class="mi">812</span><span class="p">,</span>
            <span class="s1">'width'</span> <span class="o">=&gt;</span> <span class="mi">1320</span><span class="p">,</span>
            <span class="s1">'height'</span> <span class="o">=&gt;</span> <span class="mi">620</span>
        <span class="p">}</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="n">redactions</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<h2 id="Processor Support">Processor Support</h2>

<p>Not all processors support redaction; see the <a href="processors.html#Supported%20Features">table of processor-supported features</a>.</p>

<h2 id="Implications">Implications</h2>

<h3 id="#Performance">Performance</h3>

<p>The performance of the redaction feature largely depends on the efficiency of the delegate script method implementation. Drawing of the redactions is very cheap, costing probably no more than a few milliseconds, in most cases.</p>

<h3 id="Caching">Caching</h3>

<p>Redaction coordinates are encoded in cached-image identifiers. When redaction settings change, cached redacted images will be re-generated automatically, and images with different redactions will be cached separately.</p>

  </div>
</div>


      <footer>
</footer>

<script src="/cantaloupe/scripts/bootstrap.min.js"></script>
<script src="/cantaloupe/scripts/base.js"></script>

    </div>

  </body>

</html>
