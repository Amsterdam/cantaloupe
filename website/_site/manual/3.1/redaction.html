<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="High-performance IIIF image server in Java
">

  <title>
    Cantaloupe Image Server
    
      :: Redaction
    
  </title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="/cantaloupe/css/syntax.css">
  <link rel="stylesheet" href="/cantaloupe/css/base.css">

  <script src="/cantaloupe/scripts/jquery.min.js"></script>

  <script>
  // Redirect http:// to https:// (except on localhost)
  var host = 'http://0.0.0.0:4000'.replace('http://', '').
      replace('https://', '').split(/[/?#]/)[0];
  if (window.location.host == host && window.location.protocol != 'https:') {
    window.location.protocol = 'https:';
  }
  </script>

</head>


  <body>

    <nav class="navbar navbar-default">
  <div class="container-fluid">

    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/cantaloupe/">
        <img alt="Cantaloupe" src="/cantaloupe/images/cantaloupe.png" width="40">
      </a>
    </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Get Started <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/cantaloupe/get-started.html">For the First Time</a></li>
            <li><a href="/cantaloupe/upgrade.html">Upgrade</a></li>
            <li class="divider"></li>
            <li><a href="/cantaloupe/changes.html">Change Log</a></li>
          </ul>
        </li>
        <li><a href="/cantaloupe/manual/">User Manual</a></li>
        <li><a href="https://github.com/medusa-project/cantaloupe/">GitHub</a></li>
        <li><a href="/cantaloupe/help.html">Help &amp; Feedback</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://github.com/medusa-project/cantaloupe/releases.atom" title="Subscribe to Releases"><img width="22" height="22" src="/cantaloupe/images/feed.svg"></a></li>
      </ul>
    </div>

  </div>
</nav>


    <div class="container-fluid">
      <ul class="nav nav-pills">
  <li role="presentation" ><a href="/cantaloupe/manual/4.0/">4.0</a></li>
  <li role="presentation" ><a href="/cantaloupe/manual/3.4/">3.4</a></li>
  <li role="presentation" ><a href="/cantaloupe/manual/3.3/">3.3</a></li>
  <li role="presentation" ><a href="/cantaloupe/manual/3.2/">3.2</a></li>
  <li role="presentation"  class="active" ><a href="/cantaloupe/manual/3.1/">3.1</a></li>
  <li role="presentation" ><a href="/cantaloupe/manual/3.0/">3.0</a></li>
  <li role="presentation" ><a href="/cantaloupe/manual/2.2/">2.2</a></li>
  <li role="presentation" ><a href="/cantaloupe/manual/2.1/">2.1</a></li>
</ul>


<h1>User Manual <small class="version">3.1</small></h1>

<div class="row">
  <div class="col-sm-3">
    <ul class="nav nav-pills nav-stacked">
  <li role="presentation" >
    <a href="getting-started.html">Getting Started</a>
  </li>
  <li role="presentation" >
    <a href="endpoints.html">Endpoints</a>
  </li>
  <li role="presentation" >
    <a href="images.html">Images</a>
  </li>
  <li role="presentation" >
    <a href="resolvers.html">Resolvers</a>
  </li>
  <li role="presentation" >
    <a href="processors.html">Processors</a>
  </li>
  <li role="presentation" >
    <a href="caching.html">Caching</a>
  </li>
  <li role="presentation" >
    <a href="access-control.html">Access Control</a>
  </li>
  <li role="presentation" >
    <a href="watermarking.html">Watermarking</a>
  </li>
  <li role="presentation"  class="active" >
    <a href="redaction.html">Redaction</a>
  </li>
  <li role="presentation" >
    <a href="delegate-script.html">Delegate Script</a>
  </li>
  <li role="presentation" >
    <a href="logging.html">Logging</a>
  </li>
  <li role="presentation" >
    <a href="deployment.html">Deployment</a>
  </li>
</ul>

  </div>
  <div class="col-sm-9">
    <h1>Redaction</h1>

<ul>
  <li><a href="#Example">Example</a></li>
  <li><a href="#Processor%20Support">Processor Support</a></li>
  <li><a href="#Implications">Implications</a>
    <ul>
      <li><a href="#Performance">Performance</a></li>
      <li><a href="#Caching">Caching</a></li>
    </ul>
  </li>
</ul>

<p>Redactions are black rectangles that are overlaid onto source images in order to obscure parts of them. This can be used for copyright protection, privacy protection, or censorship, without altering any source images. Different redactions can be applied to the same image dynamically for different audiences based on client IP address, cookies, and more.</p>

<p>Redactions are defined with <code>x</code>, <code>y</code>, <code>width</code>, and <code>height</code> properties corresponding to source image coordinates. Redacted regions will be blacked out at every intersecting crop region and scale.</p>

<div class="row">
  <div class="col-sm-6">
    <figure>
      <img class="img-responsive" src="images/redaction-pre-960.jpg">
      <figcaption>Original image</figcaption>
    </figure>
  </div>
  <div class="col-sm-6">
    <figure>
      <img class="img-responsive" src="images/redaction-post-960.jpg">
      <figcaption>Redactions applied</figcaption>
    </figure>
  </div>
</div>

<p>The redaction feature works via the <a href="delegate-script.html">delegate script</a>. First, the delegate script must be enabled, and then, <code>redactions.enabled</code> must be set to <code>true</code> in the configuration file. The delegate script must implement a method called <code>Cantaloupe::redactions</code> that returns an array of source image redaction coordinates in response to a particular request.</p>

<h2 id="Example">Example</h2>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Cantaloupe</span>
  <span class="c1">##</span>
  <span class="c1"># See the argument and return value documentation in delegates.rb.sample.</span>
  <span class="c1">#</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">redactions</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">request_headers</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">,</span> <span class="n">cookies</span><span class="p">)</span>
    <span class="n">redactions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Add two redactions to an image with an identifier of "sample" for all</span>
    <span class="c1"># clients except localhost.</span>
    <span class="k">if</span> <span class="n">identifier</span> <span class="o">==</span> <span class="s1">'sample'</span>
      <span class="k">unless</span> <span class="sx">%w(127.0.0.1 ::1/128)</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">client_ip</span><span class="p">)</span>
        <span class="n">redactions</span> <span class="o">&lt;&lt;</span> <span class="p">{</span>
            <span class="s1">'x'</span> <span class="o">=&gt;</span> <span class="mi">50</span><span class="p">,</span>
            <span class="s1">'y'</span> <span class="o">=&gt;</span> <span class="mi">65</span><span class="p">,</span>
            <span class="s1">'width'</span> <span class="o">=&gt;</span> <span class="mi">120</span><span class="p">,</span>
            <span class="s1">'height'</span> <span class="o">=&gt;</span> <span class="mi">105</span>
        <span class="p">}</span>
        <span class="n">redactions</span> <span class="o">&lt;&lt;</span> <span class="p">{</span>
            <span class="s1">'x'</span> <span class="o">=&gt;</span> <span class="mi">673</span><span class="p">,</span>
            <span class="s1">'y'</span> <span class="o">=&gt;</span> <span class="mi">812</span><span class="p">,</span>
            <span class="s1">'width'</span> <span class="o">=&gt;</span> <span class="mi">1320</span><span class="p">,</span>
            <span class="s1">'height'</span> <span class="o">=&gt;</span> <span class="mi">620</span>
        <span class="p">}</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="n">redactions</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<h2 id="Processor Support">Processor Support</h2>

<p>Not all processors support redaction; see the <a href="processors.html#Supported%20Features">table of processor-supported features</a>.</p>

<h2 id="Implications">Implications</h2>

<h3 id="#Performance">Performance</h3>

<p>The performance of the redaction feature largely depends on the efficiency of the delegate script method implementation. Drawing of the redactions is very cheap, costing probably no more than a few milliseconds, in most cases.</p>

<h3 id="Caching">Caching</h3>

<p>Redaction coordinates are encoded in cached-image identifiers. When redaction settings change, cached redacted images will be re-generated automatically, and images with different redactions will be cached separately.</p>

  </div>
</div>


      <footer>
</footer>

<script src="/cantaloupe/scripts/bootstrap.min.js"></script>
<script src="/cantaloupe/scripts/base.js"></script>

    </div>

  </body>

</html>
